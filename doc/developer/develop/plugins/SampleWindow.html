<!DOCTYPE html>
<html>
    <head>
        <title>
            SampleWindow Plugin
        </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

        <link href="../../../3rdparty/googleCodePrettify/prettify.css" rel="stylesheet" type="text/css"/>
        <link href="../../res/stylesheet.css" rel="stylesheet" type="text/css"/>

        <script src="../../../3rdparty/googleCodePrettify/prettify.js" type="text/javascript"></script>
        <script src="../../../3rdparty/jQuery/jquery.js" type="text/javascript"></script>
        <script src="../../../res/common.js" type="text/javascript"></script>
        <script src="../../res/menu.js" type="text/javascript"></script>
    </head>
    <body onload="prettyPrint();" ondragstart="return false;" ondrop="return false;">
        <script type="text/javascript">
            headerAndContentsMenu("SampleWindow Plugin", "../../..");
        </script>

        <p>
            The purpose of this plugin is to extend our <a href="Sample.html">Sample</a> plugin by making it possible for the user to add two numbers through a dockable window.
        </p>

        <div class="section">
            Prerequisites
        </div>

        <ul>
            <li><a href="Sample.html">Sample</a> plugin</li>
        </ul>

        <div class="section">
            File structure
        </div>

        <pre><a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/i18n">i18n</a>
 &#9492;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/i18n/SampleWindow_fr.ts">SampleWindow_fr.ts</a>
<a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/res">res</a>
 &#9492;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/res/SampleWindow_i18n.qrc.in">SampleWindow_i18n.qrc.in</a>
<a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/src">src</a>
 &#9500;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.cpp">samplewindowplugin.cpp</a>
 &#9500;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.h">samplewindowplugin.h</a>
 &#9500;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.json">samplewindowplugin.json</a>
 &#9500;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.cpp">samplewindowwindow.cpp</a>
 &#9500;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.h">samplewindowwindow.h</a>
 &#9492;&#9472; <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.ui">samplewindowwindow.ui</a>
<a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/CMakeLists.txt">CMakeLists.txt</a></pre>

        <div class="section">
            Category
        </div>

        <p>
            Our plugin is part of the <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/">Sample</a> category, which means that its code can be found under <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/"><code>[OpenCOR]/src/plugins/sample/SampleWindow/</code></a>.
        </p>

        <div class="section">
            Interfaces
        </div>

        <p>
            Unlike for the <a href="Sample.html">Sample</a> plugin, we want our plugin to interact with OpenCOR. This means that it needs to implement some interfaces (click <a href="index.html#Interfaces">here</a> for some information on interfaces).
        </p>

        <p>
            More specifically, we want our plugin to be a dockable window, so we need to implement both the <a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.inl">Plugin</a> and <a href="https://github.com/opencor/opencor/blob/master/src/plugins/windowinterface.inl">Window</a> interfaces. While we are at it, we might as well internationalise our plugin, in which case it means that we also need to implement the <a href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.inl">Internationalisation</a> interface.
        </p>

        <div class="section">
            CMake project
        </div>

        <p>
            As for the <a href="Sample.html">Sample</a> plugin, our plugin has a <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/CMakeLists.txt"><code>CMakeLists.txt</code></a> file, which contents is:
        </p>

        <pre class="prettyprint linenums">PROJECT(SampleWindowPlugin)

# Add the plugin

ADD_PLUGIN(SampleWindow
    SOURCES
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.cpp"><code>../../i18ninterface.cpp</code></a>
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininfo.cpp"><code>../../plugininfo.cpp</code></a>
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.cpp"><code>../../plugininterface.cpp</code></a>
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/windowinterface.cpp"><code>../../windowinterface.cpp</code></a>

        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.cpp"><code>src/samplewindowplugin.cpp</code></a>
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.cpp"><code>src/samplewindowwindow.cpp</code></a>
    HEADERS_MOC
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.h"><code>src/samplewindowplugin.h</code></a>
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.h"><code>src/samplewindowwindow.h</code></a>
    UIS
        <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.ui"><code>src/samplewindowwindow.ui</code></a>
    INCLUDE_DIRS
        src
    PLUGINS
        Core
        Sample
)</pre>

        <p>
            One of the interfaces our plugin implements comes with a <code>.cpp</code> file, so we reference it (lines 7 and 9-10). Then, our plugin needs both the <a href="https://github.com/opencor/opencor/tree/master/src/plugins/miscellaneous/Core/">Core</a> and <a href="Sample.html"><a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/Sample/">Sample</a></a> plugins (the latter, to be able to use its <code>add()</code> function), so  they are referenced (lines 22 and 23) using the <code>PLUGINS</code> keyword (line 21). Our plugin comes with a dockable window, which is implemented using various files (lines 13, 16 and 18). One of those files is a <code>.ui</code> file, which is referenced using the <code>UIS</code> keyword (line 17).
        </p>

        <div class="section">
            Plugin information
        </div>

        <p>
            Our <a href="index.html#Plugin information">plugin information</a> can be found in <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.cpp"><code>samplewindowplugin.cpp</code></a>, <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.h"><code>samplewindowplugin.h</code></a> and <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.json"><code>samplewindowplugin.json</code></a>. Starting with <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.h"><code>samplewindowplugin.h</code></a>, its contents is:
        </p>

        <pre class="prettyprint linenums:27">#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.h"><code>i18ninterface.h</code></a>"
#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininfo.h"><code>plugininfo.h</code></a>"
#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.h"><code>plugininterface.h</code></a>"
#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/windowinterface.h"><code>windowinterface.h</code></a>"

//==============================================================================

namespace OpenCOR {
namespace SampleWindow {

//==============================================================================

PLUGININFO_FUNC SampleWindowPluginInfo();

//==============================================================================

class SampleWindowWindow;

//==============================================================================

class SampleWindowPlugin : public QObject, public I18nInterface,
                           public PluginInterface, public WindowInterface
{
    Q_OBJECT

    Q_PLUGIN_METADATA(IID "OpenCOR.SampleWindowPlugin" FILE "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.json"><code>samplewindowplugin.json</code></a>")

    Q_INTERFACES(OpenCOR::I18nInterface)
    Q_INTERFACES(OpenCOR::PluginInterface)
    Q_INTERFACES(OpenCOR::WindowInterface)

public:
#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.inl"><code>i18ninterface.inl</code></a>"
#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.inl"><code>plugininterface.inl</code></a>"
#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/windowinterface.inl"><code>windowinterface.inl</code></a>"

private:
    QAction *mSampleWindowAction;

    SampleWindowWindow *mSampleWindowWindow;
};

//==============================================================================

}   // namespace SampleWindow
}   // namespace OpenCOR</pre>

        <p>
            As mentioned above, our plugin implements some interfaces, which means that their header file is included (lines 27, 29 and 30). It also means that our plugin class inherits from those interfaces (lines 47-48), as well as make calls to the <code>Q_INTERFACES()</code> macro to let <a href="https://www.qt.io/">Qt</a> know which interfaces it implements (lines 54-56). Finally, we include the inline files (lines 59-61) that declare various methods that must be implemented by our plugin (see the <a href="#Interfaces implementation">next section</a>). (The rest of the class definition is specific to our plugin and is discussed <a href="#Plugin specific">below</a>.)
        </p>

        <p>
            The C function that is used by OpenCOR to retrieve some <a href="index.html#Basic information">basic information</a> about our plugin can be found in <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.cpp"><code>samplewindowplugin.cpp</code></a>:
        </p>

        <pre class="prettyprint linenums:38">PLUGININFO_FUNC SampleWindowPluginInfo()
{
    Descriptions descriptions;

    descriptions.insert("en", QString::fromUtf8("a plugin that provides an addition window."));
    descriptions.insert("fr", QString::fromUtf8("une extension qui fournit une fenêtre d'addition."));

    return new PluginInfo(PluginInfo::Sample, true, false,
                          QStringList() << "Core" << "Sample",
                          descriptions);
}</pre>

        <p>
            As can be seen, our plugin is selectable by the user, but it does not offer direct <a href="https://en.wikipedia.org/wiki/Command-line_interface">CLI</a> support (line 45). It also has a direct dependency on both the <a href="https://github.com/opencor/opencor/tree/master/src/plugins/miscellaneous/Core/">Core</a> and <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/Sample/">Sample</a> plugins (line 46).
        </p>

        <span class="anchor" id="Interfaces implementation"></span>

        <div class="section">
            Interfaces implementation
        </div>

        <p>
            The implementation of the interfaces' various methods can also be found in <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowplugin.cpp"><code>samplewindowplugin.cpp</code></a>. The methods are grouped by interface and are ordered alphabetically. The interfaces are also ordered alphabetically, making it easier to read and maintain the code.
        </p>

        <p>
            We start with the <a href="https://github.com/opencor/opencor/blob/master/src/plugins/i18ninterface.inl">Internationalisation</a> interface:
        </p>

        <pre class="prettyprint linenums:50">//==============================================================================
// I18n interface
//==============================================================================

void SampleWindowPlugin::retranslateUi()
{
    // Retranslate our sample window action

    retranslateAction(mSampleWindowAction,
                      tr("Sample"),
                      tr("Show/hide the Sample window"));
}

//==============================================================================</pre>

        <p>
            All that we need to do here is to (re)translate <code>mSampleWindowAction</code> with the actual (French) translations in <a href="https://github.com/opencor/opencor/tree/master/src/plugins/sample/SampleWindow/i18n/SampleWindow_fr.ts"><code>SampleWindow_fr.ts</code></a> (together with some other translations needed in the <a href="#Plugin specific">next section</a>). Note that <code>mSampleWindowAction</code> is initialised in our implementation of the <a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.inl">Plugin</a> interface (see below).
        </p>

        <p>
            Next, we have the <a href="https://github.com/opencor/opencor/blob/master/src/plugins/plugininterface.inl">Plugin</a> interface:
        </p>

        <pre class="prettyprint linenums:63">//==============================================================================
// Plugin interface
//==============================================================================

bool SampleWindowPlugin::definesPluginInterfaces()
{
    // We don't handle this interface...

    return false;
}

//==============================================================================

bool SampleWindowPlugin::pluginInterfacesOk(const QString &pFileName,
                                            QObject *pInstance)
{
    Q_UNUSED(pFileName);
    Q_UNUSED(pInstance);

    // We don't handle this interface...

    return false;
}

//==============================================================================

void SampleWindowPlugin::initializePlugin()
{
    // Create an action to show/hide our sample window

    mSampleWindowAction = Core::newAction(true, Core::mainWindow());

    // Create our sample window

    mSampleWindowWindow = new SampleWindowWindow(Core::mainWindow());
}

//==============================================================================

void SampleWindowPlugin::finalizePlugin()
{
    // We don't handle this interface...
}

//==============================================================================

void SampleWindowPlugin::pluginsInitialized(const Plugins &pLoadedPlugins)
{
    Q_UNUSED(pLoadedPlugins);

    // We don't handle this interface...
}

//==============================================================================

void SampleWindowPlugin::loadSettings(QSettings *pSettings)
{
    Q_UNUSED(pSettings);

    // We don't handle this interface...
}

//==============================================================================

void SampleWindowPlugin::saveSettings(QSettings *pSettings) const
{
    Q_UNUSED(pSettings);

    // We don't handle this interface...
}

//==============================================================================

void SampleWindowPlugin::handleUrl(const QUrl &pUrl)
{
    Q_UNUSED(pUrl);

    // We don't handle this interface...
}

//==============================================================================</pre>

        <p>
            The only method of interest to our plugin is <code>initializePlugin()</code> (lines 89-98), which is where we initialise both <code>mSampleWindowAction</code> and <code>mSampleWindowWindow </code>. All the other methods (<code>finalizePlugin()</code>, <code>pluginsInitialized()</code>, <code>loadSettings()</code>, <code>saveSettings()</code> and <code>handleUrl()</code>) are left empty.
        </p>

        <p>
            Finally, we have the <a href="https://github.com/opencor/opencor/blob/master/src/plugins/windowinterface.inl">Window</a> interface:
        </p>

        <pre class="prettyprint linenums:143">//==============================================================================
// Window interface
//==============================================================================

Qt::DockWidgetArea SampleWindowPlugin::windowDefaultDockArea() const
{
    // Return our default dock area

    return Qt::TopDockWidgetArea;
}

//==============================================================================

QAction * SampleWindowPlugin::windowAction() const
{
    // Return our window action

    return mSampleWindowAction;
}

//==============================================================================

QDockWidget * SampleWindowPlugin::windowWidget() const
{
    // Return our window widget

    return mSampleWindowWindow;
}

//==============================================================================</pre>

        <p>
            All three methods are implemented since they tell OpenCOR the default dock area for our plugin window (see <code>windowDefaultDockArea()</code>; lines 147-152), as well as provide the pointer to our action (see <code>windowAction()</code>; lines 156-161) and window (see <code>windowWidget()</code>; lines 165-170).
        </p>

        <span class="anchor" id="Plugin specific"></span>

        <div class="section">
            Plugin specific
        </div>

        <p>
            Some extra work is needed to get our plugin to do what it is supposed to be doing, and this is done via the <code>SampleWindowWindow</code> class in <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.h"><code>samplewindowwindow.h</code></a>:
        </p>

        <pre class="prettyprint linenums:27">#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/miscellaneous/Core/src/windowwidget.h"><code>windowwidget.h</code></a>"

//==============================================================================

namespace Ui {
    class SampleWindowWindow;
}

//==============================================================================

namespace OpenCOR {
namespace SampleWindow {

//==============================================================================

class SampleWindowWindow : public Core::WindowWidget
{
    Q_OBJECT

public:
    explicit SampleWindowWindow(QWidget *pParent);
    ~SampleWindowWindow();

private:
    Ui::SampleWindowWindow *mGui;

private slots:
    void updateSum();
};

//==============================================================================

}   // namespace SampleWindow
}   // namespace OpenCOR</pre>

        <p>
            <code>SampleWindowWindow</code> inherits from <code>Core::WindowWidget</code>, which is defined in the <a href="https://github.com/opencor/opencor/tree/master/src/plugins/miscellaneous/Core/">Core</a> plugin and is an extended version of <a href="https://www.qt.io/">Qt</a>'s <code>QDockWidget</code> (line 42). It also comes with a GUI file, which describes the layout of our plugin window (<a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.ui"><code>samplewindowwindow.ui</code></a>).
        </p>

        <p>
            The implementation of <code>SampleWindowWindow</code> can be found in <a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.cpp"><code>samplewindowwindow.cpp</code></a>:
        </p>

        <pre class="prettyprint linenums:23">#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/Sample/src/sampleutilities.h"><code>sampleutilities.h</code></a>"
#include "<a href="https://github.com/opencor/opencor/blob/master/src/plugins/sample/SampleWindow/src/samplewindowwindow.h"><code>samplewindowwindow.h</code></a>"

//==============================================================================

#include "ui_samplewindowwindow.h"

//==============================================================================

namespace OpenCOR {
namespace SampleWindow {

//==============================================================================

SampleWindowWindow::SampleWindowWindow(QWidget *pParent) :
    Core::WindowWidget(pParent),
    mGui(new Ui::SampleWindowWindow)
{
    // Set up the GUI

    mGui->setupUi(this);

    // A couple of connections to update our sum whenever one of the value of
    // one of our numbers is updated

    connect(mGui->nb1DoubleSpinBox, SIGNAL(valueChanged(double)),
            this, SLOT(updateSum()));
    connect(mGui->nb2DoubleSpinBox, SIGNAL(valueChanged(double)),
            this, SLOT(updateSum()));

    // Initialise our sum

    updateSum();
}

//==============================================================================

SampleWindowWindow::~SampleWindowWindow()
{
    // Delete the GUI

    delete mGui;
}

//==============================================================================

void SampleWindowWindow::updateSum()
{
    // Update our sum

    mGui->sumLabel->setText(QString::number(Sample::add(mGui->nb1DoubleSpinBox->value(), mGui->nb2DoubleSpinBox->value())));
}

//==============================================================================

}   // namespace SampleWindow
}   // namespace OpenCOR</pre>

        <p>
            <code>SampleWindowWindow()</code> (lines 37-56) initialises the <code>SampleWindowWindow</code> object, as well as creates a couple of connections (lines 48-51) and initialises our sum by calling <code>updateSum()</code> (line 55). As can be seen, <code>updateSum()</code> calls the <code>add()</code> method from the <a href="Sample.html">Sample</a> plugin (lines 69-74).
        </p>

        <script type="text/javascript">
            copyright("../../..");
        </script>
    </body>
</html>
