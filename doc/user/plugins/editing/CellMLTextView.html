<!DOCTYPE html>
<html>
    <head>
        <title>
            CellMLTextView Plugin
        </title>

        <meta http-equiv="content-type" content="text/html; charset=utf-8"/>

        <link href="../../../3rdparty/KaTeX/katex.min.css" rel="stylesheet" type="text/css"/>
        <link href="../../res/stylesheet.css" rel="stylesheet" type="text/css"/>
        <link href="../../res/cellmlText.css" rel="stylesheet" type="text/css"/>

        <script src="../../../3rdparty/jQuery/jquery.js" type="text/javascript"></script>
        <script src="../../../3rdparty/KaTeX/katex.min.js" type="text/javascript"></script>
        <script src="../../../3rdparty/KaTeX/contrib/auto-render.min.js" type="text/javascript"></script>
        <script src="../../../res/common.js" type="text/javascript"></script>
        <script src="../../res/menu.js" type="text/javascript"></script>
        <script src="../../res/imagepopup.js" type="text/javascript"></script>
    </head>
    <body ondragstart="return false;" ondrop="return false;">
        <script type="text/javascript">
            headerAndContentsMenu("CellMLTextView Plugin", "../../..");
        </script>

        <p>
            The CellMLTextView plugin can be used to edit <a href="https://www.cellml.org/">CellML</a> files using a text editor that supports the <a href="#CellML Text format">CellML Text format</a>. If you open a CellML file, then it will look something like:
        </p>

        <p class="center">
            <img class="link" src="res/pics/CellMLTextViewScreenshot01.png" width=360 height=270 imagepopup>
        </p>

        <p>
            Apart from using a specific format, the view has the same features as the <a href="RawCellMLView.html">RawCellML</a> view with one exception: currently, <code>CellML Validation</code> only validates against the <a href="#CellML Text format">CellML Text format</a>.
        </p>

        <div class="section">
            Compatibility with COR
        </div>

        <p>
            People familiar with <a href="https://web.archive.org/web/20151013113657/http://cor.physiol.ox.ac.uk/">COR</a> will find that the <a href="#CellML Text format">CellML Text format</a> is compatible with the COR format, except for some new features that have been added:
        </p>

        <ul>
            <li><a href="#Comments">Comments</a>;</li>
            <li>The <code>import</code> element (i.e. support for <a href="https://www.cellml.org/specifications/cellml_1.1">CellML 1.1</a>);</li>
            <li>The <code>cmeta:id</code> attribute on all CellML elements (i.e. support for CellML annotation);</li>
            <li>The <code>degree</code> qualifier for the <code>diff</code> element (i.e. support for higher-order derivatives);</li>
            <li>The <code>notanumber</code> and <code>infinity</code> constants; and</li>
            <li>An unlimited number of group types (in <a href="https://web.archive.org/web/20151013113657/http://cor.physiol.ox.ac.uk/">COR</a>, a group can only specify one <code>encapsulation</code> and/or one <code>containment</code> type).</li>
        </ul>

        <p>
            Note that the <a href="https://web.archive.org/web/20151013113657/http://cor.physiol.ox.ac.uk/">COR</a> format has some limitations that are also present in the <a href="#CellML Text format">CellML Text format</a>:
        </p>

        <ul>
            <li>The <code>reaction</code> element is not supported (its use is not only discouraged, but it has also been proposed that it be removed from the next CellML specifications);</li>
            <li>A <code>piecewise</code> statement can only be used as part of a top-level <code>eq</code> statement, and nested <code>piecewise</code> statements are not allowed (the latter is not a limitation <em>per se</em> since an equation can always be rewritten without the need for nested <code>piecewise</code> statements; more importantly, it is easier to read and maintain an equation that uses only one top-level <code>piecewise</code> statement); and</li>
            <li>A <code>component</code> element may contain a set of <code>math</code> elements, but its rendering is such that when serialised back, only one <code>math</code> element will remain, with all the equations in that one and unique <code>math</code> element.</li>
        </ul>

        <span class="anchor" id="Comments"></span>

        <div class="section">
            Comments
        </div>

        <p>
            You can (un)comment a piece of code by pressing <code>Ctrl</code>+<code>/</code>. If no text is selected or if it consists of one or several full lines, then the comment will be rendered as <code>// XXX</code>, e.g.
        </p>

        <pre><span class="keyword">def model</span> my_model <span class="keyword">as</span>
    <span class="comment">// A single line comment</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            Alternatively, if one or several lines are partially selected, then the comment will be rendered as <code>/* XXX */</code>, e.g.
        </p>

        <pre><span class="keyword">def model</span> my_<span class="comment">/*super_duper_*/</span>model <span class="keyword">as</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            Note that <code>/* XXX */</code> comments are only for convenience and are not serialised back to CellML. Indeed, such comments can be inserted anywhere, including within an equation, e.g.
        </p>

        <pre><span class="keyword">ode</span>(V, time) = -(i_Na+i_K+i_Leak<span class="comment">/*+i_Stim*/</span>)/Cm;</pre>

        <p>
            It is therefore difficult, if not impossible, to determine where such comments should be included when serialised back.
        </p>

        <p>
             <code>// XXX</code> comments can also be inserted anywhere, but unlike <code>/* XXX */</code> comments they are serialised back. However, the rendering of certain elements using the <a href="#CellML Text format">CellML Text format</a> is such that when serialised back, <code>// XXX</code> comments may be included in the parent element of those elements, and either before or after those elements, depending on the case.
        </p>

        <span class="anchor" id="CellML Text format"></span>

        <div class="section">
            CellML Text format
        </div>

        <p>
            The CellML Text format offers, for the large part, a one-to-one mapping to the CellML format with the view of making it easier to create and edit CellML files.
        </p>

        <div class="subSection">
            Model structure
        </div>

        <p>
            To <code>def</code>ine a <code>model</code> of name <code>my_model</code>, we would use:
        </p>

        <pre><span class="keyword">def model</span> my_model <span class="keyword">as</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            The model definition sits between <code>as</code> and <code>enddef;</code>, and can consist of <a href="#Imports">imports</a>, <a href="#Unit definitions">unit definitions</a>, <a href="#Component definitions">component definitions</a>, <a href="#Group definitions">group definitions</a> and <a href="#Mapping definitions">mapping definitions</a>.
        </p>

        <span class="anchor" id="Imports"></span>

        <div class="subSection">
            Imports
        </div>

        <p>
            To <code>def</code>ine an <code>import</code> for units and components defined in a CellML file, which <a href="https://en.wikipedia.org/wiki/Uniform_resource_identifier">URI</a> is <code>my_imported_model_uri</code>, we would use:
        </p>

        <pre><span class="keyword">def import using</span> <span class="string">"my_imported_model_uri"</span> <span class="keyword">for</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            To import a <code>unit</code> originally named <code>my_reference_unit</code> and renamed <code>my_imported_unit</code> in our model, we would use:
        </p>

        <pre><span class="keyword">unit</span> my_imported_unit <span class="keyword">using unit</span> my_reference_unit;</pre>

        <p>
            Similarly, to import a <code>component</code> originally named <code>my_reference_component</code> and renamed <code>my_imported_component</code> in our model, we would use:
        </p>

        <pre><span class="keyword">comp</span> my_imported_component <span class="keyword">using comp</span> my_reference_component;</pre>

        <p>
            Putting everything together, we would have:
        </p>

        <pre><span class="keyword">def import</span> <span class="keyword">using</span> <span class="string">"my_imported_model_uri"</span> <span class="keyword">for</span>
    <span class="keyword">unit</span> my_imported_unit <span class="keyword">using unit</span> my_reference_unit;
    <span class="keyword">comp</span> my_imported_component <span class="keyword">using comp</span> my_reference_component;
<span class="keyword">enddef</span>;</pre>

        <span class="anchor" id="Unit definitions"></span>

        <div class="subSection">
            Unit definitions
        </div>

        <p>
            To <code>def</code>ine a <code>base unit</code> of name <code>my_base_unit</code>, we would use:
        </p>

        <pre><span class="keyword">def unit</span> my_base_unit <span class="keyword">as</span> <span class="cellmlKeyword">base</span> <span class="keyword">unit</span>;</pre>

        <p>
            To <code>def</code>ine a <code>unit</code> of name <code>my_unit</code>, based on some other units, we would use:
        </p>

        <pre><span class="keyword">def unit</span> my_unit <span class="keyword">as</span>
    <span class="keyword">unit</span> my_other_unit <span class="parameterBlock">{...}</span>;
    <span class="keyword">unit</span> <span class="cellmlKeyword">second</span> <span class="parameterBlock">{...}</span>;
    <span class="keyword">unit</span> <span class="cellmlKeyword">litre</span> <span class="parameterBlock">{...}</span>;
    <span class="keyword">unit</span> <span class="cellmlKeyword">volt</span> <span class="parameterBlock">{...}</span>;
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            <code>my_other_unit</code> refers to a user-defined unit while <code>second</code> is an <a href="https://en.wikipedia.org/wiki/International_System_of_Units">SI</a> base unit, <code>litre</code> a convenience unit and <code>volt</code> an <a href="https://en.wikipedia.org/wiki/International_System_of_Units">SI</a> derived unit . The following SI base (in bold) and derived units, as well as convenience units (in italics), can be used:
        </p>

        <table>
            <tr>
                <td class="center siBaseUnit">ampere</td>
                <td class="center">becquerel</td>
                <td class="center siBaseUnit">candela</td>
                <td class="center">celsius</td>
                <td class="center">coulomb</td>
                <td class="center convenienceUnit">dimensionless</td>
            </tr>
            <tr>
                <td class="center">farad</td>
                <td class="center convenienceUnit">gram</td>
                <td class="center">gray</td>
                <td class="center">henry</td>
                <td class="center">hertz</td>
                <td class="center">joule</td>
            </tr>
            <tr>
                <td class="center">katal</td>
                <td class="center siBaseUnit">kelvin</td>
                <td class="center siBaseUnit">kilogram</td>
                <td class="center convenienceUnit">liter</td>
                <td class="center convenienceUnit">litre</td>
                <td class="center">lumen</td>
            </tr>
            <tr>
                <td class="center">lux</td>
                <td class="center siBaseUnit">meter</td>
                <td class="center siBaseUnit">metre</td>
                <td class="center siBaseUnit">mole</td>
                <td class="center">newton</td>
                <td class="center">ohm</td>
            </tr>
            <tr>
                <td class="center">pascal</td>
                <td class="center">radian</td>
                <td class="center siBaseUnit">second</td>
                <td class="center">siemens</td>
                <td class="center">sievert</td>
                <td class="center">steradian</td>
            </tr>
            <tr>
                <td class="center">tesla</td>
                <td class="center">volt</td>
                <td class="center">watt</td>
                <td class="center">weber</td>
                <td/>
                <td/>
            </tr>
        </table>

        <p class="katexRendering">
            Additional information can be provided within curly brackets. Thus, <code>pref</code>ix, <code>expo</code>nent, <code>mult</code>iplier and <code>off</code>set values of $p$, $e$, $m$ and $o$ can be used on a unit $u$ to define a new unit equal to $m \cdot (p \cdot u)^e+o$. For example, to define <code>my_unit</code> as being equal to $3(milli \cdot my\_other\_unit)^{-1}+7$, we would use:
        </p>

        <pre><span class="keyword">def unit</span> my_unit <span class="keyword">as</span>
    <span class="keyword">unit</span> my_other_unit <span class="parameterBlock">{<span class="keyword">pref</span>: <span class="cellmlKeyword">milli</span>, <span class="keyword">expo</span>: -<span class="number">1</span>, <span class="keyword">mult</span>: <span class="number">3</span>, <span class="keyword">off</span>: <span class="number">7</span>}</span>;
<span class="keyword">enddef</span>;</pre>

        <p class="katexRendering">
            By default, <code>pref</code>, <code>expo</code>, <code>mult</code> and <code>off</code> have a value of $0$, $1.0$, $1.0$ and $0.0$, respectively. <code>pref</code> can either be an integer or have any of the following values:
        </p>

        <table class="katexRendering">
            <tr>
                <td class="center">yotta</td>
                <td class="number">$10^{24}$</td>
                <td/>
                <td class="center">deci</td>
                <td class="number">$10^{-1}$</td>
            </tr>
            <tr>
                <td class="center">zetta</td>
                <td class="number">$10^{21}$</td>
                <td/>
                <td class="center">centi</td>
                <td class="number">$10^{-2}$</td>
            </tr>
            <tr>
                <td class="center">exa</td>
                <td class="number">$10^{18}$</td>
                <td/>
                <td class="center">milli</td>
                <td class="number">$10^{-3}$</td>
            </tr>
            <tr>
                <td class="center">peta</td>
                <td class="number">$10^{15}$</td>
                <td/>
                <td class="center">micro</td>
                <td class="number">$10^{-6}$</td>
            </tr>
            <tr>
                <td class="center">tera</td>
                <td class="number">$10^{12}$</td>
                <td/>
                <td class="center">nano</td>
                <td class="number">$10^{-9}$</td>
            </tr>
            <tr>
                <td class="center">giga</td>
                <td class="number">$10^{9}$</td>
                <td/>
                <td class="center">pico</td>
                <td class="number">$10^{-12}$</td>
            </tr>
            <tr>
                <td class="center">mega</td>
                <td class="number">$10^{6}$</td>
                <td/>
                <td class="center">femto</td>
                <td class="number">$10^{-15}$</td>
            </tr>
            <tr>
                <td class="center">kilo</td>
                <td class="number">$10^{3}$</td>
                <td/>
                <td class="center">atto</td>
                <td class="number">$10^{-18}$</td>
            </tr>
            <tr>
                <td class="center">hecto</td>
                <td class="number">$10^{2}$</td>
                <td/>
                <td class="center">zepto</td>
                <td class="number">$10^{-21}$</td>
            </tr>
            <tr>
                <td class="center">deka</td>
                <td class="number">$10^{1}$</td>
                <td/>
                <td class="center">yocto</td>
                <td class="number">$10^{-24}$</td>
            </tr>
        </table>

        <span class="anchor" id="Component definitions"></span>

        <div class="subSection">
            Component definitions
        </div>

        <p>
            To <code>def</code>ine a <code>comp</code>onent of name <code>my_component</code>, we would use:
        </p>

        <pre><span class="keyword">def comp</span> my_component <span class="keyword">as</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            The component definition sits between <code>as</code> and <code>enddef;</code>, and can consist of <a href="#Unit definitions">unit definitions</a>, <a href="#Variable definitions">variable definitions</a> and <a href="#Mathematical equations">mathematical equations</a>.
        </p>

        <span class="anchor" id="Variable definitions"></span>

        <div class="subSection">
            Variable definitions
        </div>

        <p>
            To <code>def</code>ine a <code>var</code>iable of name <code>my_variable</code> and of unit <code>my_unit</code>, we would use:
        </p>

        <pre><span class="keyword">var</span> my_variable: my_unit <span class="parameterBlock">{...}</span>;</pre>

        <p class="katexRendering">
            Additional information can be provided within curly brackets: an <code>init</code>ial value, a <code>pub</code>lic interface and/or a <code>priv</code>ate interface. For example, to initialise <code>my_variable</code> to $3$ and set its public and private interfaces to <code>in</code> and <code>out</code>, respectively, we would use:
        </p>

        <pre><span class="keyword">var</span> my_variable: my_unit <span class="parameterBlock">{<span class="keyword">init</span>: <span class="number">3</span>, <span class="keyword">pub</span>: <span class="cellmlKeyword">in</span>, <span class="keyword">priv</span>: <span class="cellmlKeyword">out</span>}</span>;</pre>

        <p>
            By default, <code>init</code> has no value (i.e. the variable is not initialised) while <code>pub</code> and <code>priv</code> have a value of <code>none</code> (i.e. the variable belongs to the current component and is not visible to other components in the model). <code>init</code> can either take a real number as a value or the name of a variable defined in the current component. Both <code>pub</code> and <code>priv</code> can take any of the following values: <code>none</code>, <code>in</code> or <code>out</code>.
        </p>

        <span class="anchor" id="Mathematical equations"></span>

        <div class="subSection">
            Mathematical equations
        </div>

        <p class="katexRendering">
            A mathematical equation must either have an identifier or an ODE on its left hand side, i.e. $x=...$ and $\frac{dx}{dt}=...$, respectively. To write such equations, we would use:
        </p>

        <pre>x = ...;</pre>

        <p>
            and
        </p>

        <pre><span class="keyword">ode</span>(x, t) = ...;</pre>

        <p>
            The ODE is a first-order ODE and could also be written:
        </p>

        <pre><span class="keyword">ode</span>(x, t, <span class="number">1</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)</pre>

        <p class="katexRendering">
            As can be seen, the order of the ODE is specified using a constant value of unit <code>dimensionless</code>, which means that to write $\frac{d^2 x}{dt^2}$, $\frac{d^3 x}{dt^3}$, etc., we would use:
        </p>

        <pre><span class="keyword">ode</span>(x, t, <span class="number">2</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">ode</span>(x, t, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
...</pre>

        <span class="anchor" id="mathematicalOperatorsElementsAndConstants"></span>

        <p>
            The right hand side of a mathematical equation can use any of the following mathematical operators, elements and constants:
        </p>

        <ul>
            <li>
                Relational operators:

                <table>
                    <tr>
                        <td class="center"><code>=</code></td>
                        <td>Equality (assignment)</td>
                        <td><pre class="sampleCode">x = y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>==</code></td>
                        <td>Equality (binary)</td>
                        <td><pre class="sampleCode">x == y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>&lt;&gt;</code></td>
                        <td>Inequality</td>
                        <td><pre class="sampleCode">x &lt;&gt; y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>&gt;</code></td>
                        <td>Greater than</td>
                        <td><pre class="sampleCode">x &gt; y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>&lt;</code></td>
                        <td>Lower than</td>
                        <td><pre class="sampleCode">x &lt; y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>&gt;=</code></td>
                        <td>Greater than or equal to</td>
                        <td><pre class="sampleCode">x &gt;= y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>&lt;=</code></td>
                        <td>Lower than or equal to</td>
                        <td><pre class="sampleCode">x &lt;= y</pre></td>
                    </tr>
                </table>
            </li>
            <li>
                Arithmetic operators:

                <table>
                    <tr>
                        <td class="center"><code>+</code></td>
                        <td>Addition</td>
                        <td><pre class="sampleCode">x+y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>-</code></td>
                        <td>Subtraction</td>
                        <td><pre class="sampleCode">x-y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>*</code></td>
                        <td>Multiplication</td>
                        <td><pre class="sampleCode">x*y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>/</code></td>
                        <td>Division</td>
                        <td><pre class="sampleCode">x/y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>pow</code></td>
                        <td>Exponentiation (generic)</td>
                        <td><pre class="sampleCode"><span class="keyword">pow</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">pow</span>(x, y)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>sqr</code></td>
                        <td>Exponentiation (square)</td>
                        <td><pre class="sampleCode"><span class="keyword">sqr</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>root</code></td>
                        <td>Root (generic)</td>
                        <td><pre class="sampleCode"><span class="keyword">root</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">root</span>(x, y)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>sqrt</code></td>
                        <td>Root (square)</td>
                        <td><pre class="sampleCode"><span class="keyword">sqrt</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>abs</code></td>
                        <td>Absolute value</td>
                        <td><pre class="sampleCode"><span class="keyword">abs</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>exp</code></td>
                        <td>Exponential</td>
                        <td><pre class="sampleCode"><span class="keyword">exp</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>ln</code></td>
                        <td>Natural logarithm</td>
                        <td><pre class="sampleCode"><span class="keyword">ln</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>log</code></td>
                        <td>Logarithm</td>
                        <td><pre class="sampleCode"><span class="keyword">log</span>(x)
<span class="keyword">log</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">log</span>(x, y)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>floor</code></td>
                        <td>Floor</td>
                        <td><pre class="sampleCode"><span class="keyword">floor</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>ceil</code></td>
                        <td>Ceiling</td>
                        <td><pre class="sampleCode"><span class="keyword">ceil</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>fact</code></td>
                        <td>Factorial</td>
                        <td><pre class="sampleCode"><span class="keyword">fact</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>rem</code></td>
                        <td>Remainder</td>
                        <td><pre class="sampleCode"><span class="keyword">rem</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">rem</span>(x, y)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>min</code></td>
                        <td>Minimum</td>
                        <td><pre class="sampleCode"><span class="keyword">min</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">min</span>(x, y)
<span class="keyword">min</span>(x, y, z)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>max</code></td>
                        <td>Maximum</td>
                        <td><pre class="sampleCode"><span class="keyword">max</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">max</span>(x, y)
<span class="keyword">max</span>(x, y, z)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>gcd</code></td>
                        <td>Greatest common divisor</td>
                        <td><pre class="sampleCode"><span class="keyword">gcd</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">gcd</span>(x, y)
<span class="keyword">gcd</span>(x, y, z)</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>lcm</code></td>
                        <td>Least common multiple</td>
                        <td><pre class="sampleCode"><span class="keyword">lcm</span>(x, <span class="number">3</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)
<span class="keyword">lcm</span>(x, y)
<span class="keyword">lcm</span>(x, y, z)</pre></td>
                    </tr>
                </table>
            </li>
            <li>
                Logical operators:

                <table>
                    <tr>
                        <td class="center"><code>and</code></td>
                        <td>And</td>
                        <td><pre class="sampleCode">x <span class="keyword">and</span> y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>or</code></td>
                        <td>Or</td>
                        <td><pre class="sampleCode">x <span class="keyword">or</span> y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>xor</code></td>
                        <td>Exclusive or</td>
                        <td><pre class="sampleCode">x <span class="keyword">xor</span> y</pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>not</code></td>
                        <td>Not</td>
                        <td><pre class="sampleCode"><span class="keyword">not</span> x
<span class="keyword">not</span>(x <span class="keyword">and</span> y)</pre></td>
                    </tr>
                </table>
            </li>
            <li>
                Calculus elements:

                <table>
                    <tr>
                        <td class="center"><code>ode</code></td>
                        <td>Differentiation</td>
                        <td><pre class="sampleCode"><span class="keyword">ode</span>(x, t)
<span class="keyword">ode</span>(x, t, <span class="number">2</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>)</pre></td>
                    </tr>
                </table>
            </li>
            <li>
                Trigonometric operators:

                <table>
                    <tr>
                        <td class="center">
                            <code>sin</code><br/>
                            <code>sinh</code><br/>
                            <code>asin</code><br/>
                            <code>asinh</code>
                        </td>
                        <td>
                            Sine<br/>
                            Hyperbolic sine<br/>
                            Inverse sine<br/>
                            Inverse hyperbolic sine
                        </td>
                        <td><pre class="sampleCode"><span class="keyword">sin</span>(x)
<span class="keyword">sinh</span>(x)
<span class="keyword">asin</span>(x)
<span class="keyword">asinh</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center">
                            <code>cos</code><br/>
                            <code>cosh</code><br/>
                            <code>acos</code><br/>
                            <code>acosh</code>
                        </td>
                        <td>
                            Cosine<br/>
                            Hyperbolic cosine<br/>
                            Inverse cosine<br/>
                            Inverse hyperbolic cosine
                        </td>
                        <td><pre class="sampleCode"><span class="keyword">cos</span>(x)
<span class="keyword">cosh</span>(x)
<span class="keyword">acos</span>(x)
<span class="keyword">acosh</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center">
                            <code>tan</code><br/>
                            <code>tanh</code><br/>
                            <code>atan</code><br/>
                            <code>atanh</code>
                        </td>
                        <td>
                            Tangent<br/>
                            Hyperbolic tangent<br/>
                            Inverse tangent<br/>
                            Inverse hyperbolic tangent
                        </td>
                        <td><pre class="sampleCode"><span class="keyword">tan</span>(x)
<span class="keyword">tanh</span>(x)
<span class="keyword">atan</span>(x)
<span class="keyword">atanh</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center">
                            <code>sec</code><br/>
                            <code>sech</code><br/>
                            <code>asec</code><br/>
                            <code>asech</code>
                        </td>
                        <td>
                            Secant<br/>
                            Hyperbolic secant<br/>
                            Inverse secant<br/>
                            Inverse hyperbolic secant
                        </td>
                        <td><pre class="sampleCode"><span class="keyword">sec</span>(x)
<span class="keyword">sech</span>(x)
<span class="keyword">asec</span>(x)
<span class="keyword">asech</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center">
                            <code>csc</code><br/>
                            <code>csch</code><br/>
                            <code>acsc</code><br/>
                            <code>acsch</code>
                        </td>
                        <td>
                            Cosecant<br/>
                            Hyperbolic cosecant<br/>
                            Inverse cosecant<br/>
                            Inverse hyperbolic cosecant
                        </td>
                        <td><pre class="sampleCode"><span class="keyword">csc</span>(x)
<span class="keyword">csch</span>(x)
<span class="keyword">acsc</span>(x)
<span class="keyword">acsch</span>(x)</pre></td>
                    </tr>
                    <tr>
                        <td class="center">
                            <code>cot</code><br/>
                            <code>coth</code><br/>
                            <code>acot</code><br/>
                            <code>acoth</code>
                        </td>
                        <td>
                            Cotangent<br/>
                            Hyperbolic cotangent<br/>
                            Inverse cotangent<br/>
                            Inverse hyperbolic cotangent
                        </td>
                        <td><pre class="sampleCode"><span class="keyword">cot</span>(x)
<span class="keyword">coth</span>(x)
<span class="keyword">acot</span>(x)
<span class="keyword">acoth</span>(x)</pre></td>
                    </tr>
                </table>
            </li>
            <li>
                Constants:

                <table>
                    <tr>
                        <td class="center"><code>true</code></td>
                        <td>True</td>
                        <td><pre class="sampleCode"><span class="keyword">true</span></pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>false</code></td>
                        <td>False</td>
                        <td><pre class="sampleCode"><span class="keyword">false</span></pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>nan</code></td>
                        <td>Not a number</td>
                        <td><pre class="sampleCode"><span class="keyword">nan</span></pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>pi</code></td>
                        <td>Pi</td>
                        <td><pre class="sampleCode"><span class="keyword">pi</span></pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>inf</code></td>
                        <td>Infinity</td>
                        <td><pre class="sampleCode"><span class="keyword">inf</span></pre></td>
                    </tr>
                    <tr>
                        <td class="center"><code>e</code></td>
                        <td>Euler's number</td>
                        <td><pre class="sampleCode"><span class="keyword">e</span></pre></td>
                    </tr>
                </table>
            </li>
        </ul>

        <p class="katexRendering">
            A piecewise statement can also be used in the top-level of the right hand side of a mathematical equation. For example, to define $x$ as being equal to $y+z$ when $x > 0$ and $y-z$ otherwise, we would use:
        </p>

        <pre>x = <span class="keyword">sel</span>
    <span class="keyword">case</span> x > <span class="number">0</span><span class="unit">{<span class="cellmlKeyword">dimensionless</span>}</span>:
        y+z;
    <span class="keyword">otherwise</span>:
        y-z;
<span class="keyword">endsel</span>;</pre>

        <span class="anchor" id="Group definitions"></span>

        <div class="subSection">
            Group definitions
        </div>

        <p>
            To <code>def</code>ine a <code>group</code>, we would use:
        </p>

        <pre><span class="keyword">def group as</span> ... <span class="keyword">for</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            A group must be typed as a <code>containment</code> and/or an <code>encapsulation</code>. For example, to define a containment group, we would use:
        </p>

        <pre><span class="keyword">def group as</span> <span class="cellmlKeyword">containment</span> <span class="keyword">for</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            A containment group can be named. For example, to define a containment group of name <code>my_containment</code>, we would use:
        </p>

        <pre><span class="keyword">def group as</span> <span class="cellmlKeyword">containment</span> my_containment <span class="keyword">for</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            An encapsulation group is always nameless, so to define an encapsulation group, we would use:
        </p>

        <pre><span class="keyword">def group as</span> <span class="cellmlKeyword">encapsulation</span> <span class="keyword">for</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            A group can have more than one type. For example, to define a group as both an encapsulation group and a containment group (of name <code>my_containment</code>), we would use:
        </p>

        <pre><span class="keyword">def group as</span> <span class="cellmlKeyword">encapsulation</span> <span class="keyword">and</span> <span class="cellmlKeyword">containment</span> my_containment <span class="keyword">for</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            A group definition is used whenever there is a need for a hierarchy of components. Some components may include others. For example, to define a group where both <code>my_component1</code> and <code>my_component2</code> are at the top level, and where <code>my_component1</code> includes <code>my_component11</code>, <code>my_component12</code> and <code>my_component13</code>, we would use:
        </p>

        <pre><span class="keyword">def group as</span> ... <span class="keyword">for</span>
    <span class="keyword">comp</span> my_component1 <span class="keyword">incl</span>
        <span class="keyword">comp</span> my_component11;
        <span class="keyword">comp</span> my_component12;
        <span class="keyword">comp</span> my_component13;
    <span class="keyword">endcomp</span>;

    <span class="keyword">comp</span> my_component2;
<span class="keyword">enddef</span>;</pre>

        <p>
            Similarly, to define a group where <code>my_component1</code> is at the top level, and where <code>my_component1</code> includes <code>my_component11</code> and <code>my_component12</code>, and where <code>my_component11</code> includes <code>my_component111</code>, we would use:
        </p>

        <pre><span class="keyword">def group as</span> ... <span class="keyword">for</span>
    <span class="keyword">comp</span> my_component1 <span class="keyword">incl</span>
        <span class="keyword">comp</span> my_component11 <span class="keyword">incl</span>
            <span class="keyword">comp</span> my_component111;
        <span class="keyword">endcomp</span>;

        <span class="keyword">comp</span> my_component12;
    <span class="keyword">endcomp</span>;
<span class="keyword">enddef</span>;</pre>

        <span class="anchor" id="Mapping definitions"></span>

        <div class="subSection">
            Mapping definitions
        </div>

        <p>
            To <code>def</code>ine some <code>map</code>pings between two components of name <code>my_component1</code> and <code>my_component2</code>, we would use:
        </p>

        <pre><span class="keyword">def map between</span> my_component1 <span class="keyword">and</span> my_component2</span> <span class="keyword">for</span>
    ...
<span class="keyword">enddef</span>;</pre>

        <p>
            To map variables <code>my_variable1a</code> with <code>my_variable2a</code>, <code>my_variable1b</code> with <code>my_variable2b</code>, and <code>my_variable1c</code> with <code>my_variable2c</code> from components <code>my_component1</code> and <code>my_component2</code>, respectively, we would use:
        </p>

        <pre><span class="keyword">def map between</span> my_component1 <span class="keyword">and</span> my_component2</span> <span class="keyword">for</span>
    <span class="keyword">vars</span> my_variable1a <span class="keyword">and</span> my_variable2a;
    <span class="keyword">vars</span> my_variable1b <span class="keyword">and</span> my_variable2b;
    <span class="keyword">vars</span> my_variable1c <span class="keyword">and</span> my_variable2c;
<span class="keyword">enddef</span>;</pre>

        <div class="subSection">
            Metadata
        </div>

        <p>
            The CellML Text format does not support the editing of CellML annotations. However, <code>cmeta:id</code>'s are used to make the link between CellML elements and CellML annotations. So, we need the CellML Text format to support the use of <code>cmeta:id</code>'s and this is done by enclosing a <code>cmeta:id</code> value (e.g. <code>my_cmeta_id</code>) within curly brackets:
        </p>

        <pre><span class="cmetaId">{my_cmeta_id}</span></pre>

        <p>
            which can then be used to annotate various CellML elements:
        </p>

        <pre><span class="keyword">def model</span><span class="cmetaId">{my_model_cmeta_id}</span> my_model <span class="keyword">as</span>
    <span class="keyword">def import</span><span class="cmetaId">{my_import_cmeta_id}</span> <span class="keyword">using</span> <span class="string">"my_imported_model_uri"</span> <span class="keyword">for</span>
        <span class="keyword">unit</span><span class="cmetaId">{my_imported_unit_cmeta_id}</span> my_imported_unit <span class="keyword">using unit</span> my_reference_unit;

        <span class="keyword">comp</span><span class="cmetaId">{my_imported_component_cmeta_id}</span> my_imported_component <span class="keyword">using comp</span> my_reference_component;
    <span class="keyword">enddef</span>;

    <span class="keyword">def unit</span><span class="cmetaId">{my_base_unit_cmeta_id}</span> my_base_unit <span class="keyword">as</span> <span class="cellmlKeyword">base</span> <span class="keyword">unit</span>;

    <span class="keyword">def unit</span><span class="cmetaId">{my_unit_cmeta_id}</span> my_unit <span class="keyword">as</span>
        <span class="keyword">unit</span><span class="cmetaId">{my_other_unit_cmeta_id}</span> my_other_unit <span class="parameterBlock">{<span class="keyword">pref</span>: <span class="cellmlKeyword">milli</span>, <span class="keyword">expo</span>: -<span class="number">1</span>, <span class="keyword">mult</span>: <span class="number">3</span>, <span class="keyword">off</span>: <span class="number">7</span>}</span>;
    <span class="keyword">enddef</span>;

    <span class="keyword">def comp</span><span class="cmetaId">{my_component_cmeta_id}</span> my_component <span class="keyword">as</span>
        <span class="keyword">var</span><span class="cmetaId">{my_variable_cmeta_id}</span> my_variable: my_unit <span class="parameterBlock">{<span class="keyword">init</span>: <span class="number">3</span>, <span class="keyword">pub</span>: <span class="cellmlKeyword">in</span>, <span class="keyword">priv</span>: <span class="cellmlKeyword">out</span>}</span>;

        a =<span class="cmetaId">{my_algebraic_equation_cmeta_id}</span> b+c;
        <span class="keyword">ode</span>(d, t) =<span class="cmetaId">{my_ode_equation_cmeta_id}</span> e+f;
    <span class="keyword">enddef</span>;

    <span class="keyword">def group</span><span class="cmetaId">{my_group_cmeta_id}</span> <span class="keyword">as</span> <span class="cellmlKeyword">encapsulation</span><span class="cmetaId">{my_encapsulation_cmeta_id}</span> <span class="keyword">and</span> <span class="cellmlKeyword">containment</span><span class="cmetaId">{my_containment_cmeta_id}</span> my_containment <span class="keyword">for</span>
        <span class="keyword">comp</span><span class="cmetaId">{my_component1_cmeta_id}</span> my_component1 <span class="keyword">incl</span>
            <span class="keyword">comp</span><span class="cmetaId">{my_component11_cmeta_id}</span> my_component11;
            <span class="keyword">comp</span><span class="cmetaId">{my_component12_cmeta_id}</span> my_component12;
            <span class="keyword">comp</span><span class="cmetaId">{my_component13_cmeta_id}</span> my_component13;
        <span class="keyword">endcomp</span>;

        <span class="keyword">comp</span><span class="cmetaId">{my_component2_cmeta_id}</span> my_component2;
    <span class="keyword">enddef</span>;

    <span class="keyword">def map</span><span class="cmetaId">{my_map_cmeta_id}</span> <span class="keyword">between</span><span class="cmetaId">{my_between_cmeta_id}</span> my_component1 <span class="keyword">and</span> my_component2</span> <span class="keyword">for</span>
        <span class="keyword">vars</span><span class="cmetaId">{my_varsa_cmeta_id}</span> my_variable1a <span class="keyword">and</span> my_variable2a;
        <span class="keyword">vars</span><span class="cmetaId">{my_varsb_cmeta_id}</span> my_variable1b <span class="keyword">and</span> my_variable2b;
        <span class="keyword">vars</span><span class="cmetaId">{my_varsc_cmeta_id}</span> my_variable1c <span class="keyword">and</span> my_variable2c;
    <span class="keyword">enddef</span>;
<span class="keyword">enddef</span>;</pre>

        <div class="section">
            CLI support
        </div>

        <p>
            The CellMLTextView plugin relies on the <a href="#CellML Text format">CellML Text format</a>. CLI support has therefore been added to it so that a <a href="https://www.cellml.org/">CellML</a> file can, from the command line, be imported to the <a href="#CellML Text format">CellML Text format</a>, and back.
        </p>

        <p>
            For example, to import <code>models/van_der_pol_model_1928.cellml</code> to the CellML Text format, we would do the following:
        </p>

        <pre>$ ./OpenCOR -c CellMLTextView::import models/van_der_pol_model_1928.cellml
def model van_der_pol_model_1928 as
    def comp main as
        def unit per_second as
            unit second {expo: -1};
        enddef;

        var time: second;
        var x: dimensionless {init: -2};
        var y: dimensionless {init: 0};
        var epsilon: dimensionless {init: 1};

        ode(x, time) = y*1{per_second};
        ode(y, time) = (epsilon*(1{dimensionless}-sqr(x))*y-x)*1{per_second};
    enddef;
enddef;</pre>

        <p>
            Similarly, and assuming the above import has been saved to a file named <code>van_der_pol_model_1928.txt</code>, we could get our original CellML file by doing the following:
        </p>

        <pre>$ ./OpenCOR -c CellMLTextView::export van_der_pol_model_1928.txt > van_der_pol_model_1928.cellml</pre>

        <p>
            For precaution, the new CellML file relies on CellML 1.1, as confirmed by <code>diff</code>:
        </p>

        <pre>$ diff models/van_der_pol_model_1928.cellml van_der_pol_model_1928.cellml
2c2
&lt; &lt;model name="van_der_pol_model_1928" xmlns="http://www.cellml.org/cellml/1.0#" xmlns:cellml="http://www.cellml.org/cellml/1.0#"&gt;
---
&gt; &lt;model name="van_der_pol_model_1928" xmlns="http://www.cellml.org/cellml/1.1#" xmlns:cellml="http://www.cellml.org/cellml/1.1#"&gt;</pre>

        <br/>

        <script type="text/javascript">
            katexRendering();

            copyright("../../..");
        </script>
    </body>
</html>
